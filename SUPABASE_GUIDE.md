# Supabase å¤šè®¾å¤‡åŒæ­¥åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“– æ¦‚è¿°

æœ¬é¡¹ç›®å·²é›†æˆ Supabase äº‘ç«¯æ•°æ®åº“,æ”¯æŒå¤šè®¾å¤‡æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚æ•°æ®åŒæ—¶ä¿å­˜åœ¨æœ¬åœ° IndexedDB å’Œ Supabase äº‘ç«¯,å®ç°ç¦»çº¿å¯ç”¨ã€åœ¨çº¿åŒæ­¥çš„ä½“éªŒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæ•°æ®åº“è¡¨

1. è®¿é—® [Supabase Dashboard](https://app.supabase.com)
2. ç™»å½•å¹¶é€‰æ‹©æ‚¨çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå•çš„ **SQL Editor**
4. ç‚¹å‡» **New query**
5. å¤åˆ¶ `supabase-schema.sql` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
6. ç²˜è´´åˆ° SQL ç¼–è¾‘å™¨ä¸­
7. ç‚¹å‡» **Run** æ‰§è¡Œ SQL

### 2. éªŒè¯è¡¨åˆ›å»º

åœ¨ SQL Editor ä¸­è¿è¡Œä»¥ä¸‹æŸ¥è¯¢:

```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- æŸ¥çœ‹ tasks è¡¨ç»“æ„
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'tasks';

-- æŸ¥çœ‹ quick_notes è¡¨ç»“æ„
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'quick_notes';
```

### 3. æµ‹è¯•åŒæ­¥åŠŸèƒ½

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨:
   ```bash
   npm run dev
   ```

2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨

3. åˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»»åŠ¡

4. åœ¨ Supabase Dashboard ä¸­æŸ¥çœ‹æ•°æ®:
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ **Table Editor**
   - é€‰æ‹© `tasks` è¡¨
   - æŸ¥çœ‹æ˜¯å¦æœ‰æ–°åˆ›å»ºçš„ä»»åŠ¡æ•°æ®

## ğŸ”§ ç¯å¢ƒé…ç½®

### .env æ–‡ä»¶

é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶åŒ…å« Supabase è¿æ¥ä¿¡æ¯:

```env
VITE_SUPABASE_URL=https://svpyvbozpqvdacmbsufd.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

âš ï¸ **æ³¨æ„**: `.env` æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`,ä¸ä¼šè¢«æäº¤åˆ° Git

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### tasks è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | ä¸»é”®,ä»»åŠ¡å”¯ä¸€æ ‡è¯† |
| title | TEXT | ä»»åŠ¡æ ‡é¢˜ |
| description | TEXT | ä»»åŠ¡æè¿° |
| subtasks | JSONB | å­ä»»åŠ¡åˆ—è¡¨ |
| date | TEXT | ä»»åŠ¡æ—¥æœŸ (YYYY-MM-DD) |
| quadrant | TEXT | æ‰€å±è±¡é™ (Q1/Q2/Q3/Q4) |
| tag | TEXT | ä»»åŠ¡æ ‡ç­¾ |
| completed | TEXT | å®Œæˆæ—¥æœŸ (YYYY-MM-DD æˆ– NULL) |
| completed_at | BIGINT | å®Œæˆæ—¶é—´æˆ³ |
| progress | INTEGER | è¿›åº¦ (0-100) |
| created_at | BIGINT | åˆ›å»ºæ—¶é—´æˆ³ |
| order | BIGINT | æ’åºé¡ºåº |
| is_overdue | BOOLEAN | æ˜¯å¦é€¾æœŸ |
| updated_at | TIMESTAMP | æœ€åæ›´æ–°æ—¶é—´ |

### quick_notes è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | ä¸»é”®,ç¬”è®°å”¯ä¸€æ ‡è¯† |
| content | TEXT | ç¬”è®°å†…å®¹ |
| created_at | BIGINT | åˆ›å»ºæ—¶é—´æˆ³ |
| tags | TEXT[] | æ ‡ç­¾æ•°ç»„ |
| linked_task_id | TEXT | å…³è”çš„ä»»åŠ¡ ID |
| is_starred | BOOLEAN | æ˜¯å¦æ ‡æ˜Ÿ |
| color | TEXT | é¢œè‰²æ ‡è®° |
| attachments | TEXT[] | é™„ä»¶åˆ—è¡¨ |
| updated_at | TIMESTAMP | æœ€åæ›´æ–°æ—¶é—´ |

## ğŸ”„ åŒæ­¥æœºåˆ¶

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
   â†“
React ç»„ä»¶
   â†“
Context/Hooks
   â†“
db.ts
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IndexedDB  â”‚   Supabase   â”‚
â”‚  (æœ¬åœ°å­˜å‚¨)  â”‚  (äº‘ç«¯åŒæ­¥)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒæ­¥ç­–ç•¥

1. **åœ¨çº¿æ¨¡å¼**:
   - æ•°æ®åŒæ—¶å†™å…¥ IndexedDB å’Œ Supabase
   - è¯»å–ä¼˜å…ˆä» IndexedDB (å¿«é€Ÿå“åº”)

2. **ç¦»çº¿æ¨¡å¼**:
   - æ•°æ®ä»…å†™å…¥ IndexedDB
   - é€šè¿‡ `navigator.onLine` æ£€æµ‹ç½‘ç»œçŠ¶æ€

3. **å†²çªå¤„ç†**:
   - ä½¿ç”¨ `updated_at` æ—¶é—´æˆ³åˆ¤æ–­æœ€æ–°æ•°æ®
   - åç»­ç‰ˆæœ¬å°†å®ç°æ›´å¤æ‚çš„å†²çªè§£å†³ç­–ç•¥

## ğŸ› ï¸ è¾…åŠ©åŠŸèƒ½

### è·å–ä»»åŠ¡ç»Ÿè®¡

åœ¨ Supabase SQL Editor ä¸­è¿è¡Œ:

```sql
SELECT * FROM get_task_stats();
```

è¿”å›:
- æ€»ä»»åŠ¡æ•°
- å·²å®Œæˆä»»åŠ¡æ•°
- å¾…åŠä»»åŠ¡æ•°
- é€¾æœŸä»»åŠ¡æ•°
- å„è±¡é™ä»»åŠ¡åˆ†å¸ƒ

### æ¸…ç†æ—§ä»»åŠ¡

æ¸…ç† 30 å¤©å‰çš„å·²å®Œæˆä»»åŠ¡:

```sql
SELECT cleanup_old_completed_tasks(30);
```

## ğŸ” å®‰å…¨ç­–ç•¥

å½“å‰é…ç½®:
- å¯ç”¨äº† Row Level Security (RLS)
- å…è®¸åŒ¿åç”¨æˆ·è®¿é—®(å¼€å‘/æµ‹è¯•ç¯å¢ƒ)

âš ï¸ **ç”Ÿäº§ç¯å¢ƒå»ºè®®**:
- å®ç°ç”¨æˆ·è®¤è¯
- é…ç½®åŸºäºç”¨æˆ·çš„ RLS ç­–ç•¥
- é™åˆ¶åŒ¿åè®¿é—®æƒé™

## ğŸ“± å¤šè®¾å¤‡åŒæ­¥

### ä½¿ç”¨åœºæ™¯

1. **ç”µè„‘å’Œæ‰‹æœºåŒæ­¥**:
   - åœ¨ç”µè„‘ä¸Šåˆ›å»ºä»»åŠ¡
   - åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹å’Œæ›´æ–°
   - æ•°æ®å®æ—¶åŒæ­¥

2. **å¤šå°ç”µè„‘åŒæ­¥**:
   - åœ¨åŠå…¬å®¤ç”µè„‘ä¸Šå·¥ä½œ
   - åœ¨å®¶é‡Œç”µè„‘ä¸Šç»§ç»­
   - æ— ç¼åˆ‡æ¢

### æµ‹è¯•æ­¥éª¤

1. åœ¨è®¾å¤‡ A ä¸Šåˆ›å»ºä»»åŠ¡
2. åœ¨è®¾å¤‡ B ä¸Šåˆ·æ–°é¡µé¢
3. éªŒè¯ä»»åŠ¡æ˜¯å¦å‡ºç°
4. åœ¨è®¾å¤‡ B ä¸Šä¿®æ”¹ä»»åŠ¡
5. åœ¨è®¾å¤‡ A ä¸Šåˆ·æ–°éªŒè¯

## ğŸ› æ•…éšœæ’æŸ¥

### æ•°æ®æœªåŒæ­¥

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. éªŒè¯ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®
4. æ£€æŸ¥ Supabase é¡¹ç›®çŠ¶æ€

### æŸ¥çœ‹åŒæ­¥æ—¥å¿—

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·,æŸ¥çœ‹ Network æ ‡ç­¾ä¸­çš„ Supabase è¯·æ±‚

### å¸¸è§é”™è¯¯

**é”™è¯¯**: `Cannot find module '@supabase/supabase-js'`
**è§£å†³**: è¿è¡Œ `npm install`

**é”™è¯¯**: `Invalid API key`
**è§£å†³**: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `VITE_SUPABASE_ANON_KEY`

**é”™è¯¯**: `Table does not exist`
**è§£å†³**: åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œ `supabase-schema.sql`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- [Supabase JavaScript å®¢æˆ·ç«¯](https://supabase.com/docs/reference/javascript/introduction)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] å®ç°ç¦»çº¿é˜Ÿåˆ—æœºåˆ¶
- [ ] æ·»åŠ åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨
- [ ] å®ç°å†²çªè§£å†³ç­–ç•¥
- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯
- [ ] ä¼˜åŒ–åŒæ­¥æ€§èƒ½

## ğŸ’¬ æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æŸ¥çœ‹:
- `implementation_plan.md` - è¯¦ç»†å®æ–½è®¡åˆ’
- `walkthrough.md` - å·¥ä½œæ€»ç»“æ–‡æ¡£
- `task.md` - ä»»åŠ¡æ¸…å•
